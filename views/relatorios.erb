<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Relatório de Estoque</h2>
</div>

<div class="card mb-4">
  <div class="card-header">Filtros de Relatório</div>
  <div class="card-body">
    <form action="/relatorios" method="GET" class="form-filter">
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="filter-codigo" class="form-label">Código:</label>
          <input type="text" id="filter-codigo" name="codigo" class="form-control" value="<%= h(params[:codigo]) if params[:codigo] %>" placeholder="Buscar por código...">
        </div>
        <div class="col-md-4 mb-3">
          <label for="filter-categoria" class="form-label">Categoria:</label>
          <select id="filter-categoria" name="categoria[nome]" class="form-control">
            <option value="">Todas as Categorias</option>
            <% @categorias_disponiveis.each do |categoria| %>
              <option value="<%= h(categoria) %>" <%= 'selected' if params[:categoria] && params[:categoria][:nome] == categoria %>>
                <%= h(categoria) %>
              </option>
            <% end %>
          </select>
        </div>
        <div class="col-md-4 mb-3 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2">Aplicar Filtros</button>
          <a href="/relatorios" class="btn btn-secondary">Limpar Filtros</a>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header">
    Total de Produtos: <%= @total_produtos %>
  </div>
  <div class="table-wrapper">
    <table id="tabela-relatorios"> <thead>
    <tr>
      <th>Nome</th>
      <th>Código</th>
      <th>Categoria</th>
      <th>Qtd.</th>
      <th>Preço Unit.</th>
      <th>Valor Total</th>
    </tr>
    </thead>
      <tbody>
      <% if @produtos.empty? %>
        <tr>
          <td colspan="6" class="text-center">Nenhum produto encontrado com os filtros aplicados.</td>
        </tr>
      <% else %>
        <% @produtos.each do |produto| %>
          <tr>
            <td><%= h produto['nome'] %></td>
            <td class="coluna-codigo"><%= h produto['codigo'] %></td> <td class="coluna-categoria"><%= h produto['categoria'] %></td> <td><%= produto['quantidade'] %></td>
            <td>R$ <%= '%.2f' % produto['preco'] %></td>
            <td>R$ <%= '%.2f' % (produto['preco'].to_f * produto['quantidade'].to_i) %></td>
          </tr>
        <% end %>
      <% end %>
      </tbody>
    </table>
  </div>
</div>